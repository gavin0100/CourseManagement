<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>FrontEnd</title>
    <meta name="description" content="Ela Admin - HTML5 Admin Template"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="apple-touch-icon" href="https://i.imgur.com/QRAUqs9.png"/>
    <link rel="shortcut icon" href="https://i.imgur.com/QRAUqs9.png"/>

    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css"
    />

    <link th:href="@{/assets/Thang/css/cs-skin-elastic.css}" rel="stylesheet"/>
    <link th:href="@{/assets/Thang/css/style.css}" rel="stylesheet"/>
    <link th:href="@{/assets/Thang/css/ui_users.css}" rel="stylesheet"/>
    <link th:href="@{/assets/Thang/css/login/bootstrap.css}" rel="stylesheet"/>

    <link th:href="@{/assets/Thang/css/syllabus/syllabus.css}" />
    <link th:href="@{/assets/Thang/css/ui_syllabus.css}" rel="stylesheet" />
    <!--    <link th:href="@{/assets/thai/ui_users.css}" rel="stylesheet"/>-->
    <!--    <link th:href="@{/assets/css/ui_users.css}" rel="stylesheet"/>-->
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->


    <link
            href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css"
            rel="stylesheet"
    />
    <link
            href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css"
            rel="stylesheet"
    />

    <link
            href="https://cdn.jsdelivr.net/npm/weathericons@2.1.0/css/weather-icons.css"
            rel="stylesheet"
    />
    <link
            href="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.css"
            rel="stylesheet"
    />

    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <link
            href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
            rel="stylesheet"
    />
    <style>
        #weatherWidget .currentDesc {
            color: #ffffff !important;
        }

        .traffic-chart {
            min-height: 335px;
        }

        #flotPie1 {
            height: 150px;
        }

        #flotPie1 td {
            padding: 3px;
        }

        #flotPie1 table {
            top: 20px !important;
            right: -10px !important;
        }

        .chart-container {
            display: table;
            min-width: 270px;
            text-align: left;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        #flotLine5 {
            height: 105px;
        }

        #flotBarChart {
            height: 150px;
        }

        #cellPaiChart {
            height: 160px;
        }

        .bars-icon {
            position: absolute;
            top: 18px;
        }


        #saveButton {
            display: none; /* Ẩn liên kết mặc định */
        }

    </style>

    <script
            src="https://kit.fontawesome.com/8f73a47761.js"
            crossorigin="anonymous"
    ></script>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
    <script src="/assets/js/main.js"></script>
</head>
<body>
<!--Begin: SideBar-->
<div th:replace="~{common/side_bar :: side_bar}"></div>
<!--End: SideBar-->


<div id="right-panel" class="right-panel">
    <!--Begin: Header-->
    <div th:replace="~{common/header :: header}"></div>
    <!--End: Footer-->

    <!--Begin: Content-->
    <div class="content">
        <!-- Animated -->
        <div class="animated fadeIn">
            <h2>View Syllabus</h2>
            <div class="col-md-12 form-group">
                <div id="errorMessage" th:if="${message}" class="alert alert-success" role="alert"
                     th:text="${message}">
                </div>
                <div id="errorMessage1" th:if="${errorMessage}" class="alert alert-danger" role="alert"
                     th:text="${errorMessage}">
                </div>
            </div>
            <div class="search-box">
                <div class="search">
                    <a class="my-button" href="/syllabus/create" style="background-color: #1784A3" id="showFormButton"><i class="fas fa-plus add"></i>Add Syllabus</a>
                    <button class="my-button showImportButton" id="showImportButton" style="background-color: #ed5c11;"><i class="fa-solid fa-file-import add"></i>Import</button>
                </div>
            </div>

            <table id="example" class="table table-striped" style="width:100%">
                <thead>
                <tr>
                    <th style="display: none"></th>
                    <th class="custom-column">Syllabus</th>
                    <th class="custom-column">Code</th>
                    <th class="custom-column">Modified on</th>
                    <th class="custom-column">Create by</th>
                    <th class="custom-column">Duration</th>
                    <th class="custom-column">Output standard</th>
                    <th class="custom-column">Status</th>
                    <th class="custom-column"></th>
                </tr>
                </thead>
                <tbody>
                <tr class="spandd" th:each="syllabus : ${syllabus}">
                    <td style="display: none" th:text="${syllabus.getTopicCode()}"></td>
                    <td th:text="${syllabus.getTopicName()}"></td>
                    <td th:text="${syllabus.getTopicCode()}"></td>
                    <td th:text="${syllabus.getModifiedDate()}"></td>
                    <td th:text="${syllabus.getCreatedBy().getEmail()}"></td>
                    <td th:text="${syllabus.getDuration()}"></td>
                    <td>
                        <ul style="list-style: none">
                            <li style="display: inline-block"
                                th:each="learningObjectives : ${syllabus.getLearningObjectives()}">
                                <span th:text="${learningObjectives.getName()}"></span>
                            </li>
                        </ul>
                    </td>
                    <td>
                        <div th:text="${syllabus.getPublishStatus()}"
                             th:class="${'status ' + (syllabus.getPublishStatus() == 'Inactive' ? 'inactive-status' : (syllabus.getPublishStatus() == 'Active' ? 'active-status' : 'draft-status'))}"></div>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button class="dropbtn"><i class="fas fa-ellipsis-h"></i></button>
                            <div class="dropdown-content">
                                <a href="#" class="edit-user-button" th:data-id="${syllabus.getTopicCode()}"
                                   id="showEditUser" onclick="showEditForm(this.getAttribute('data-id'));">
                                    <i class="fas fa-pencil-alt"></i>
                                    Edit syllabus</a>
                                <a style="color: #0D6EFD; cursor: pointer;" th:data-id="${syllabus.getTopicCode()}" class="activeTag"

                                   th:classappend="${syllabus.getPublishStatus() == 'Active' ? 'disabled' : ''}">
                                    <i th:classappend="${syllabus.getPublishStatus() == 'Active' ? 'fas fa-eye-slash'  : 'fa-sharp fa-solid fa-eye'}"></i>
                                    <span style="border: none;
                                                background: none;
                                                padding: 0px;
                                                color: #0D6EFD;"
                                          th:text="${syllabus.getPublishStatus() == 'Active' ? 'In-active' : 'Active'}"></span>
                                </a>
                                <a href="#" class="deltail-syllabus" th:data-id="${syllabus.getTopicCode()}"
                                   onclick="detail(this.getAttribute('data-id'))">
                                    <i class="fa-solid fa-info"></i>
                                    Detail
                                </a>
                                <a style="color: #0D6EFD; cursor: pointer;" th:data-id="${syllabus.getTopicCode()}" class="duplicateTag"
                                >
                                    <i class="fa-sharp fa-regular fa-copy"></i>
                                    Duplicate syllabus</a>
                                <a style="color: #0D6EFD; cursor: pointer;" id="deleteSyllabus" th:data-id="${syllabus.getTopicCode()}" class="deleteTag"
                                >
                                    <i class="fas fa-trash"></i>
                                    Delete syllabus</a>
                            </div>

                        </div>
                    </td>

                </tr>
                </tbody>
            </table>


            <div class="overlay" id="formImport">
                <div class="container">
                    <div class="form">
                        <form action="/syllabus/import" method="post" enctype="multipart/form-data">
                            <table>
                                <tr>
                                    <th style="background-color: #0f65c1;" colspan="3">Import Syllabus</th>
                                </tr>
                                <tr>
                                    <td>Import setting</td>
                                    <td><input type="file" name="file" placeholder="file" multiple></td>
                                </tr>
                            </table>
                            <div class="bk_save_user" style="margin-bottom: 5px;">
                                <button type="submit" class="button-save-user" style="background-color: #0f65c1">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <form type="hidden" style="visibility: hidden; display: none;" method="post" id="duplicateSyllabusForm" action="/syllabus/duplicate" th:object="${SyllabusRequestUI}">
                <input name="topicCode">
            </form>
            <form type="hidden" style="visibility: hidden; display: none;" method="post" id="deleteSyllabusForm" action="/syllabus/delete" th:object="${SyllabusRequestUI}">
                <input name="topicCode">
            </form>
            <form type="hidden" style="visibility: hidden; display: none;" method="post" id="approveSyllbusForm" action="/syllabus/approve" th:object="${SyllabusRequestUI}">
                <input name="topicCode">
            </form>

        </div>
        <!--End: Content-->
        <div class="clearfix"></div>
    </div>

    <!--Begin: Footer-->
    <div th:replace="~{common/footer :: footer}"></div>
    <!--End: Footer-->
</div>

<!-- Scripts -->
<!--<script>-->
<!--    $(document).ready(function () {-->
<!--        $(document).on('click', '.duplicateTag', function () {-->
<!--            const formSetActive = document.getElementById('duplicateSyllabusForm');-->
<!--            const row = $(this).closest('tr');-->
<!--            const userId = row.find('td:eq(0)').text();-->
<!--            console.log("userId: ", userId);-->
<!--            formSetActive.querySelector('[name="topicCode"]').value = userId;-->
<!--            formSetActive.submit();-->
<!--        });-->
<!--        $(document).on('click', '.deleteTag', function () {-->
<!--            const formDelete = document.getElementById('deleteSyllabusForm');-->
<!--            const row = $(this).closest('tr');-->
<!--            const userId = row.find('td:eq(0)').text();-->
<!--            // Set the values of trainingProgramId and syllabusId-->
<!--            formDelete.querySelector('[name="topicCode"]').value = userId;-->
<!--            formDelete.submit();-->
<!--        });-->
<!--        $(document).on('click', '.activeTag', function () {-->
<!--            const formDelete = document.getElementById('approveSyllbusForm');-->
<!--            const row = $(this).closest('tr');-->
<!--            const userId = row.find('td:eq(0)').text();-->
<!--            // Set the values of trainingProgramId and syllabusId-->
<!--            formDelete.querySelector('[name="topicCode"]').value = userId;-->
<!--            formDelete.submit();-->
<!--        });-->
<!--    })-->

<!--</script>-->
<script>
    function ChangeActive(topicCode, redirectUrl) {
        $.ajax({
            url: '/syllabus/approve/' + topicCode,
            type: 'POST',
            success: function (response) {
                console.log('Change active thành công');
                location.href = redirectUrl;
            },
            error: function (error) {
                console.error('Lỗi:', error);
                location.href = redirectUrl;
            },
            complete: function () {
                location.href = redirectUrl;
                history.replaceState(null, null, redirectUrl);
            }
        });
    }

    function detail(topicCode){
        $.ajax({
            url: '/syllabus/detail2/' + topicCode,
            type: 'GET',
            success: function (response) {
                console.log('detail thành công');
                window.location.href = '/syllabus/detail2/' + topicCode;
            },
            error: function (error) {
                console.error('Lỗi:', error);
            }
        });
    }
    function showEditForm(topicCode){
        $.ajax({
            url: '/syllabus/update/' + topicCode,
            type: 'GET',
            success: function (response) {
                console.log('detail thành công');
                window.location.href = '/syllabus/update/' + topicCode;
            },
            error: function (error) {
                console.error('Lỗi:', error);
            }
        });
    }
    function detail(topicCode){
        $.ajax({
            url: '/syllabus/detail2/' + topicCode,
            type: 'GET',
            success: function (response) {
                console.log('detail thành công');
                window.location.href = '/syllabus/detail2/' + topicCode;
            },
            error: function (error) {
                console.error('Lỗi:', error);
            }
        });
    }

</script>
<!--<script>-->
<!--    $(document).ready(function () {-->
<!--        $("#deleteSyllabus").click(function (event) {-->
<!--            event.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>-->

<!--            var topicCode = $(this).attr("data-id");-->

<!--            console.log(topicCode);-->
<!--            // Thiết lập giá trị userId cho input trong biểu mẫu-->
<!--            $("#topicCode").val(topicCode);-->

<!--            // Gửi biểu mẫu-->
<!--            $("#deleteForm").submit();-->
<!--        });-->
<!--    });-->
<!--</script>-->

<script>
    new DataTable('#example', {
        "order": []
    });
</script>
<script>
    $(document).ready(function () {
        $(document).on('click', '.showImportButton', function () {
            const formImport = document.getElementById('formImport');
            formImport.style.display= 'flex';
        });
        const formImport = document.getElementById('formImport');
        formImport.addEventListener('click', function (e) {
            if (e.target === formImport) {
                formImport.style.display = 'none'; // Ẩn overlay nếu bấm ra ngoài
            }
        });
        $(document).on('click', '.duplicateTag', function () {
            console.log("click duplicate tag");
            const formDuplicate = document.getElementById('duplicateSyllabusForm');
            const row = $(this).closest('tr');
            const userId = row.find('td:eq(0)').text();
            console.log("userId: ", userId);
            formDuplicate.querySelector('[name="topicCode"]').value = userId;
            formDuplicate.submit();
        });
        $(document).on('click', '.deleteTag', function () {
            console.log("click delete tag");
            const formDelete = document.getElementById('deleteSyllabusForm');
            const row = $(this).closest('tr');
            const userId = row.find('td:eq(0)').text();
            // Set the values of trainingProgramId and syllabusId
            formDelete.querySelector('[name="topicCode"]').value = userId;
            formDelete.submit();
        });
        $(document).on('click', '.activeTag', function () {
            console.log("click active tag");
            const formApprove = document.getElementById('approveSyllbusForm');
            const row = $(this).closest('tr');
            const userId = row.find('td:eq(0)').text();
            // Set the values of trainingProgramId and syllabusId
            formApprove.querySelector('[name="topicCode"]').value = userId;
            formApprove.submit();
        });
    })
</script>
</body>
</html>