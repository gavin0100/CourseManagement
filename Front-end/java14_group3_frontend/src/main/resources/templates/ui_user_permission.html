<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>FrontEnd</title>
    <meta name="description" content="Ela Admin - HTML5 Admin Template" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="apple-touch-icon" href="https://i.imgur.com/QRAUqs9.png" />
    <link rel="shortcut icon" href="https://i.imgur.com/QRAUqs9.png" />

    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css"
    />
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css"
    />

    <link th:href="@{/assets/css/cs-skin-elastic.css}" rel="stylesheet"/>
    <link th:href="@{/assets/thai/style.css}" rel="stylesheet"/>
    <link th:href="@{/assets/thai/ui_users.css}" rel="stylesheet"/>
    <link th:href="@{/assets/thai/login/bootstrap.css}" rel="stylesheet"/>
    <!--    <link th:href="@{/assets/css/ui_users.css}" rel="stylesheet"/>-->
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->


    <link
            href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css"
            rel="stylesheet"
    />
    <link
            href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css"
            rel="stylesheet"
    />

    <link
            href="https://cdn.jsdelivr.net/npm/weathericons@2.1.0/css/weather-icons.css"
            rel="stylesheet"
    />
    <link
            href="https://cdn.jsdelivr.net/npm/fullcalendar@3.9.0/dist/fullcalendar.min.css"
            rel="stylesheet"
    />

    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <link
            href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
            rel="stylesheet"
    />
    <style>
        #weatherWidget .currentDesc {
            color: #ffffff !important;
        }
        .traffic-chart {
            min-height: 335px;
        }
        #flotPie1 {
            height: 150px;
        }
        #flotPie1 td {
            padding: 3px;
        }
        #flotPie1 table {
            top: 20px !important;
            right: -10px !important;
        }
        .chart-container {
            display: table;
            min-width: 270px;
            text-align: left;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        #flotLine5 {
            height: 105px;
        }

        #flotBarChart {
            height: 150px;
        }
        #cellPaiChart {
            height: 160px;
        }

        .bars-icon {
            position: absolute;
            top: 18px;
        }


        #saveButton {
            display: none; /* Ẩn liên kết mặc định */
        }

    </style>

    <script
            src="https://kit.fontawesome.com/8f73a47761.js"
            crossorigin="anonymous"
    ></script>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
    <script src="/assets/js/main.js"></script>
</head>
<body>
<!--Begin: SideBar-->
<div th:replace="~{common/side_bar :: side_bar}"></div>
<!--End: SideBar-->


<div id="right-panel" class="right-panel">
    <!--Begin: Header-->
    <div th:replace="~{common/header :: header}"></div>
    <!--End: Footer-->

    <!--Begin: Content-->
    <div class="content">
        <!-- Animated -->
        <div class="animated fadeIn">
            <!-- Animated -->
            <div class="animated fadeIn">
                <h2>User Permission</h2>
                <div class="button-update-save">
                    <button class="update-permission-button">Update permission</button>
                    <button type="button" class="button-save" id="saveButton">Save</button>
                </div>
                <br>
                <br>
                <div class="list_permission">
                    <div class="table">
                        <table>
                            <thead>
                            <tr>
                                <th>Role name</th>
                                <th>Syllabus</th>
                                <th>Training program</th>
                                <th>Class</th>
                                <th>Learning material</th>
                                <th>User</th>
                            </tr>
                            </thead>
                            <tbody class="TBuserpermission">
                            <tr class="selected-row" th:each="user : ${users}"
                                th:data-permission-id="${user.getPermissionId()}"
                                th:data-role="${user.getRole()}"
                                th:data-training-program="${user.getTrainingProgram()}"
                                th:data-user-management="${user.getUserManagement()}"
                                th:data-learning-material="${user.getLearningMaterial()}"
                                th:data-syllabus="${user.getSyllabus()}"
                                th:data-classroom="${user.getClassRoom()}">
                                <td class="role-name"><a th:text="${user.getRole()}"></a></td>
                                <td>
                                    <i th:if="${user.getSyllabus() == 'FULL_ACCESS'}" class="fas fa-star-o permission"></i>
                                    <i th:if="${user.getSyllabus() == 'CREATE'}" class="fas fa-plus-circle permission"></i>
                                    <i th:if="${user.getSyllabus() == 'VIEW'}" class="fas fa-eye permission"></i>
                                    <i th:if="${user.getSyllabus() == 'MODIFY'}" class="fas fa-pencil-alt permission"></i>
                                    <i th:if="${user.getSyllabus() == 'ACCESS_DENIED'}" class="fa-regular fa-eye-slash permission"></i>
                                    [[${user.getSyllabus()}]]
                                </td>
                                <td>
                                    <i th:if="${user.getTrainingProgram() == 'FULL_ACCESS'}" class="fas fa-star-o permission"></i>
                                    <i th:if="${user.getTrainingProgram() == 'CREATE'}" class="fas fa-plus-circle permission"></i>
                                    <i th:if="${user.getTrainingProgram() == 'VIEW'}" class="fas fa-eye permission"></i>
                                    <i th:if="${user.getTrainingProgram() == 'MODIFY'}" class="fas fa-pencil-alt permission"></i>
                                    <i th:if="${user.getTrainingProgram() == 'ACCESS_DENIED'}" class="fa-regular fa-eye-slash permission"></i>
                                    [[${user.getTrainingProgram()}]]
                                </td>
                                <td>
                                    <i th:if="${user.getClassRoom() == 'FULL_ACCESS'}" class="fas fa-star-o permission"></i>
                                    <i th:if="${user.getClassRoom() == 'CREATE'}" class="fas fa-plus-circle permission"></i>
                                    <i th:if="${user.getClassRoom() == 'VIEW'}" class="fas fa-eye permission"></i>
                                    <i th:if="${user.getClassRoom() == 'MODIFY'}" class="fas fa-pencil-alt permission"></i>
                                    <i th:if="${user.getClassRoom() == 'ACCESS_DENIED'}" class="fa-regular fa-eye-slash permission"></i>
                                    [[${user.getClassRoom()}]]
                                </td>
                                <td>
                                    <i th:if="${user.getLearningMaterial() == 'FULL_ACCESS'}" class="fas fa-star-o permission"></i>
                                    <i th:if="${user.getLearningMaterial() == 'CREATE'}" class="fas fa-plus-circle permission"></i>
                                    <i th:if="${user.getLearningMaterial() == 'VIEW'}" class="fas fa-eye permission"></i>
                                    <i th:if="${user.getLearningMaterial() == 'MODIFY'}" class="fas fa-pencil-alt permission"></i>
                                    <i th:if="${user.getLearningMaterial() == 'ACCESS_DENIED'}" class="fa-regular fa-eye-slash permission"></i>
                                    [[${user.getLearningMaterial()}]]
                                </td>
                                <td>
                                    <i th:if="${user.getUserManagement() == 'FULL_ACCESS'}" class="fas fa-star-o permission"></i>
                                    <i th:if="${user.getUserManagement() == 'CREATE'}" class="fas fa-plus-circle permission"></i>
                                    <i th:if="${user.getUserManagement() == 'VIEW'}" class="fas fa-eye permission"></i>
                                    <i th:if="${user.getUserManagement() == 'MODIFY'}" class="fas fa-pencil-alt permission"></i>
                                    <i th:if="${user.getUserManagement() == 'ACCESS_DENIED'}" class="fa-regular fa-eye-slash permission"></i>
                                    [[${user.getUserManagement()}]]
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <form id="myForm" method="post" th:action="@{/user/permissionUpdate}">
                    <div class="update_permission">
                        <div class="table">
                            <table>
                                <thead>
                                <tr>
                                    <th>Role name</th>
                                    <th>Syllabus</th>
                                    <th>Training program</th>
                                    <th>Class</th>
                                    <th>Learning material</th>
                                    <th>User</th>
                                </tr>
                                </thead>
                                <tbody class="TBuserpermission">

                                <!--                            Supper Admin-->
                                <tr class="selected-row2">
                                    <td>
                                        <input type="hidden" name="permissionId">
                                        <input type="text" style="border: none;" name="role" readonly>
                                    </td>
                                    <td>
<!--                                        <input type="text" name="syllabus" id="syllabus">-->
                                        <select name="syllabus">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="trainingProgram" >
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="classRoom" >
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="learningMaterial">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="userManagement" >
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                </tr>

<!--                                Class Admin-->
                                <tr class="selected-row2">
                                    <td>
                                        <input type="hidden" name="permissionId">
                                        <input type="text" style="border: none;" name="role" readonly>
                                    </td>
                                    <td>
                                        <!--                                        <input type="text" name="syllabus" id="syllabus">-->
                                        <select name="syllabus">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="trainingProgram">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="classRoom">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="learningMaterial">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="userManagement">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                </tr>

<!--                                Trainer-->
                                <tr class="selected-row2">
                                    <td>
                                        <input type="hidden" name="permissionId">
                                        <input type="text" style="border: none;" name="role" readonly>
                                    </td>
                                    <td>
                                        <!--                                        <input type="text" name="syllabus" id="syllabus">-->
                                        <select name="syllabus">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="trainingProgram">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="classRoom">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="learningMaterial">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                    <td>
                                        <select name="userManagement">
                                            <option value="FULL_ACCESS">FULL_ACCESS</option>
                                            <option value="CREATE">CREATE</option>
                                            <option value="VIEW">VIEW</option>
                                            <option value="ACCESS_DENIED">ACCESS_DENIED</option>
                                            <option value="MODIFY">MODIFY</option>
                                        </select>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <!-- .animated -->
        </div>
        <!--End: Content-->
        <div class="clearfix"></div>
    </div>
    <!--Begin: Footer-->
    <div th:replace="~{common/footer :: footer}"></div>
    <!--End: Footer-->

</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Bắt sự kiện click trên nút "Save"
        const saveButton = document.getElementById("saveButton");
        saveButton.addEventListener("click", function() {
            var newData = [];

            var selectedRows = document.querySelectorAll(".TBuserpermission tr.selected-row2");
            selectedRows.forEach(function(row) {
                var permissionId = parseInt(row.querySelector('input[name="permissionId"]').value);
                var role = row.querySelector('input[name="role"]').value;

                // Đối với các trường select
                var syllabus = row.querySelector('select[name="syllabus"]').value;
                var trainingProgram = row.querySelector('select[name="trainingProgram"]').value;
                var classRoom = row.querySelector('select[name="classRoom"]').value;
                var learningMaterial = row.querySelector('select[name="learningMaterial"]').value;
                var userManagement = row.querySelector('select[name="userManagement"]').value;

                // Tạo một đối tượng data chứa các giá trị
                var item1 = {
                    permissionId: permissionId,
                    role: role,
                    syllabus: syllabus,
                    trainingProgram: trainingProgram,
                    classRoom: classRoom,
                    learningMaterial: learningMaterial,
                    userManagement: userManagement
                };

                // Thêm đối tượng vào danh sách data
                newData.push(item1);
            });

            console.log("Sau khi click save");

            if (!Array.isArray(newData)) {
                newData = [newData];
            }
            console.log(newData);
            // Gửi yêu cầu POST với Fetch API
            fetch('/user/permissionUpdate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newData),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    location.reload();
                })
                .catch((error) => {
                    console.error('Error:', error);
                    location.reload();
                });

            // Ngăn chặn sự kiện mặc định của nút Save (ví dụ: tránh submit form)
            event.preventDefault();
        });

    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const updatePermissionButton = document.querySelector(".update-permission-button");
        const listPermission = document.querySelector(".list_permission");
        const updatePermission = document.querySelector(".update_permission");
        const buttonSave = document.querySelector(".button-save");
        const selects = listPermission.getElementsByTagName("select");
        var rows = document.querySelectorAll(".TBuserpermission tr.selected-row");
        var data = [];
        var newData = [];

        // Mặc định ẩn nút "Save" và form "update_permission"
        buttonSave.style.display = "none";
        updatePermission.style.display = "none";

        // Duyệt qua từng hàng trong bảng
        rows.forEach(function(selectedRow) {
            // Lấy giá trị từ thuộc tính data-* của hàng và đặt giá trị vào các input
            const permissionId = parseInt(selectedRow.getAttribute("data-permission-id"));
            const role = selectedRow.getAttribute("data-role");
            const trainingProgram = selectedRow.getAttribute("data-training-program");
            const userManagement = selectedRow.getAttribute("data-user-management");
            const learningMaterial = selectedRow.getAttribute("data-learning-material");
            const syllabus = selectedRow.getAttribute("data-syllabus");
            const classRoom = selectedRow.getAttribute("data-classroom");

            var item = {
                permissionId: permissionId,
                role: role,
                syllabus: syllabus,
                trainingProgram: trainingProgram,
                classRoom: classRoom,
                learningMaterial: learningMaterial,
                userManagement: userManagement
            };

            // Thêm đối tượng vào danh sách data
            data.push(item);

        });
        console.log(data);

        // Thêm sự kiện bấm vào nút "Update permission".
        updatePermissionButton.addEventListener("click", function() {
            // Ẩn nút "Update permission" và hiện nút "Save" và form "update_permission"
            updatePermissionButton.style.display = "none";
            buttonSave.style.display = "block";
            updatePermission.style.display = "block";
            listPermission.style.display = "none";

            // Lấy tất cả các hàng được chọn
            var selectedRows = document.querySelectorAll(".TBuserpermission tr.selected-row2");

            // Loop through each row
            selectedRows.forEach(function(row, rowIndex) {
                // Get the data object for the current row
                const rowData = data[rowIndex];

                // Loop through each input/select in the row
                row.querySelectorAll('input, select').forEach(function(element) {
                    // Get the name attribute of the input/select
                    const name = element.name;

                    // Set the value from the data object to the corresponding input/select
                    element.value = rowData[name];
                });
            });

            selectedRows.forEach(function(row) {
                var permissionId = parseInt(row.querySelector('input[name="permissionId"]').value);
                var role = row.querySelector('input[name="role"]').value;

                // Đối với các trường select
                var syllabus = row.querySelector('select[name="syllabus"]').value;
                var trainingProgram = row.querySelector('select[name="trainingProgram"]').value;
                var classRoom = row.querySelector('select[name="classRoom"]').value;
                var learningMaterial = row.querySelector('select[name="learningMaterial"]').value;
                var userManagement = row.querySelector('select[name="userManagement"]').value;

                // Tạo một đối tượng data chứa các giá trị
                var item1 = {
                    permissionId: permissionId,
                    role: role,
                    syllabus: syllabus,
                    trainingProgram: trainingProgram,
                    classRoom: classRoom,
                    learningMaterial: learningMaterial,
                    userManagement: userManagement
                };

                // Thêm đối tượng vào danh sách data
                newData.push(item1);

            });
            // Giờ bạn có danh sách data với dữ liệu từ bảng và có thể sử dụng nó trong hàm của bạn.
             console.log(newData);

        });

    });
</script>
</body>